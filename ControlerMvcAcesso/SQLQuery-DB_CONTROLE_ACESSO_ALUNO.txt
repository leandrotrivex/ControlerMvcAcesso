

CREATE DATABASE DB_CONTROLE_ACESSO_ALUNO

Use DB_Controle_acesso_aluno

--Adicionando um campo (Cod_adm_usuario) na tabela aluno

--alter table TB_ALUNO
--add COD_ADM_USUARIO int;

--EXCLUINDO O CAMPO (COD_ADM_USUARIO) NA TABELA ALUNO
--ALTER TABLE TB_ALUNO
--DROP COLUMN COD_ADM_USUARIO;

--adicionando chave estrangeira (fk_Adm_usuario)na tabela aluno
--ALTER TABLE TB_ALUNO
--ADD CONSTRAINT FK_ADM_USUARIO FOREIGN KEY (COD_ADM_USUARIO)REFERENCES TB_ADM_USUARIO (COD_ADM_USUARIO)


CREATE TABLE TB_ADM_USUARIO (

COD_ADM_USUARIO INT NOT NULL,
NOME_ADM VARCHAR (60) NOT NULL,
SOBRENOME VARCHAR (30) NOT NULL,
EMAIL VARCHAR (100) NOT NULL,
SENHA VARCHAR (10) NOT NULL,
PERFIL VARCHAR (15) NOT NULL,
ATIVO CHAR (1) NOT NULL,
CONSTRAINT PK_ADM_USUARIO PRIMARY KEY(COD_ADM_USUARIO)

)

INSERT INTO TB_ADM_USUARIO(COD_ADM_USUARIO,NOME_ADM,SOBRENOME, EMAIL, SENHA, PERFIL,ATIVO)
VALUES (1,'Admin','Adimin' ,'admin@admin.com', '123456','Administrador', 'S' )
  
INSERT INTO TB_ADM_USUARIO(COD_ADM_USUARIO,NOME_ADM,SOBRENOME, EMAIL, SENHA, PERFIL,ATIVO)
VALUES (2,'User', 'User','user@user.com', '123456','Usuario','S')



CREATE TABLE TB_ALUNO (

COD_ALUNO INT NOT NULL,
NOME VARCHAR (50) NOT NULL,
RM VARCHAR (10) NOT NULL,
NACIMENTO DATE NOT NULL,
SEXO VARCHAR (10),
COD_ADM_USUARIO INT,
CONSTRAINT PK_ALUNO PRIMARY KEY(COD_ALUNO),
CONSTRAINT CK_SEXO_TB_ALUNO CHECK (SEXO IN ('M', 'F')),
CONSTRAINT FK_ADM_USUARIO FOREIGN KEY(COD_ADM_USUARIO) REFERENCES TB_ADM_USUARIO(COD_ADM_USUARIO)
)


INSERT INTO TB_ALUNO VALUES(01,'FULANO DE TAL','2121')
INSERT INTO TB_ALUNO VALUES(02,'BELTRANO','2323')
INSERT INTO TB_ALUNO VALUES(03,'SICLANO','3333')

--CLAUSA WHERE PRA CONSULTAR SOMENTE POR NOME FULANO DE TAL
SELECT * FROM TB_ALUNO
WHERE NOME = 'FULANO DE TAL'


--EXCLUIR A CATEGORIA QUE É FULANO DE TAL
DELETE FROM TB_ALUNO
WHERE NOME = 'FULANO DE TAL'


CREATE TABLE TB_ACESSO (

COD_ACESSO INT NOT NULL,
DATA DATE NOT NULL,
HORA_ENTRADA TIME,
HORA_SAIDA TIME,
COD_ALUNO INT,
CONSTRAINT PK_ACESSO PRIMARY KEY(COD_ACESSO),
CONSTRAINT FK_ALUNO FOREIGN KEY(COD_ALUNO) REFERENCES TB_ALUNO(COD_ALUNO)
)


INSERT INTO TB_ACESSO VALUES(1,'26/08/2019','19:10','22:50',01 )
INSERT INTO TB_ACESSO VALUES(2,'26/08/2019','19:10','22:50',02 )
INSERT INTO TB_ACESSO VALUES(3,'26/08/2019','19:10','22:50',03 )


CREATE TABLE TB_AUTORIZACAO (

COD_AUTORIZACAO INT NOT NULL,
NOME_RESPONSAVEL VARCHAR (60) NOT NULL,
RG_RESPONSAVEL INT NOT NULL,
DATA DATE NOT NULL,
HORA TIME NOT NULL,
MOTIVO VARCHAR (200) NOT NULL,
CONSTRAINT PK_AUTORIZACAO PRIMARY KEY(COD_AUTORIZACAO),
COD_ALUNO INT,
CONSTRAINT FK_ALUNO_AUTO FOREIGN KEY(COD_ALUNO) REFERENCES TB_ALUNO(COD_ALUNO)
)

CREATE TABLE TB_CURSO (

COD_CURSO INT NOT NULL,
NOME_CURSO VARCHAR (60) NOT NULL,
CONSTRAINT PK_CURSO PRIMARY KEY(COD_CURSO)
)


CREATE TABLE TB_TURMA (

COD_TURMA INT NOT NULL,
SERIE CHAR (4) NOT NULL,
PERIODO VARCHAR (10) NOT NULL,
HORA_ENTRADA TIME NOT NULL,
HORA_SAIDA TIME NOT NULL,
COD_CURSO INT,
CONSTRAINT PK_TURMA PRIMARY KEY(COD_TURMA),
CONSTRAINT FK_CURSO FOREIGN KEY(COD_CURSO) REFERENCES TB_CURSO (COD_CURSO)
)

--CRIANDO UMA REGRA (CONSTRAINT) OU SEJA ADICIONANDO A CHAVE PRIMARIA DA TABELA CURSO COMO CHAVE ESTRANGEIRA NA TABELA TURMA
CONSTRAINT FK_CURSO FOREIGN KEY(COD_CURSO) REFERENCES TB_CURSO(COD_CURSO)

CREATE TABLE TB_ALUNO_TURMA (

COD_ALUNO INT, 
COD_TURMA INT,
ANO CHAR (4) NOT NULL,
SEMESTRE VARCHAR (10) NOT NULL,
CONSTRAINT PK_ALUNO_TURMA PRIMARY KEY (COD_ALUNO, COD_TURMA, ANO, SEMESTRE),
CONSTRAINT FK_TB_ALUNO FOREIGN KEY (COD_ALUNO) REFERENCES TB_ALUNO(COD_ALUNO),
CONSTRAINT FK_TURMA FOREIGN KEY (COD_TURMA) REFERENCES TB_TURMA(COD_TURMA)
)



--Removendo a chave estrangeira (FK_Aluno) da tabela tb_adm_usuario

--alter table tb_adm_usuario
--drop constraint fk_admaluno;

 select * from TB_ADM_USUARIO

  select * from TB_ALUNO

 --Removendo o campo (COD_ALUNO) da tabela tb_adm_usuario

 --alter table tb_adm_usuario
 --drop column cod_aluno;